<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raporlab - Faraday Yasas覺</title>
    <style>
        :root {
            --bg-app: #f8fafc;
            --bg-panel: #ffffff;
            --text-main: #0f172a;
            --col-accent: #f59e0b; /* Elektrik Sar覺s覺 */
            --col-blue: #3b82f6;   /* Raporlab Mavisi */
            --col-coil: #b45309;   
            --border: #e2e8f0;
            --font: 'Segoe UI', system-ui, sans-serif;
        }

        body { margin: 0; padding: 0; background: var(--bg-app); color: var(--text-main); font-family: var(--font); height: 100vh; display: flex; overflow: hidden; }

        /* SOL PANEL */
        aside { 
            width: 320px; flex-shrink: 0; background: var(--bg-panel); border-right: 1px solid var(--border); 
            padding: 20px; display: flex; flex-direction: column; gap: 20px; z-index: 20; box-shadow: 2px 0 15px rgba(0,0,0,0.05);
        }

        /* LOGO DZELT襤LD襤: Kal覺n Mavi + 襤nce Gri */
        .logo { 
            font-size: 1.5rem; font-weight: 800; color: var(--col-blue); 
            letter-spacing: -1px; margin-bottom: 5px; 
        }

        .meter-box {
            background: #1e293b; padding: 15px; border-radius: 12px; color: white; text-align: center;
            position: relative; height: 120px; display: flex; flex-direction: column; justify-content: flex-end;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.5); border: 2px solid #475569;
        }
        .meter-scale { position: absolute; top: 10px; left: 10px; right: 10px; bottom: 30px; border-bottom: 1px solid #94a3b8; }
        .needle { 
            position: absolute; bottom: 30px; left: 50%; width: 4px; height: 70px; 
            background: #ef4444; transform-origin: bottom center; transition: transform 0.05s linear; 
            border-radius: 2px; box-shadow: 0 0 5px rgba(239, 68, 68, 0.5);
        }
        .meter-val { font-family: monospace; font-size: 1.2rem; font-weight: bold; color: var(--col-accent); }

        .control-group { background: white; border: 1px solid var(--border); padding: 15px; border-radius: 12px; }
        .group-title { font-size: 0.8rem; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 10px; }
        
        .slider-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; font-weight: 600; font-size: 0.9rem; margin-bottom: 5px; }
        input[type="range"] { flex: 1; accent-color: var(--col-accent); }

        .bulb-indicator {
            width: 60px; height: 60px; margin: 0 auto; background: #475569; border-radius: 50%;
            border: 4px solid #334155; transition: 0.05s; box-shadow: 0 0 0 rgba(255, 255, 0, 0);
        }

        .formula-box {
            margin-top: auto; background: #fffbeb; border-left: 4px solid var(--col-accent); 
            padding: 10px; border-radius: 8px; font-size: 0.9rem; color: #92400e; font-style: italic;
        }

        /* SA PANEL */
        main { flex: 1; position: relative; background: #e2e8f0; cursor: default; display: flex; flex-direction: column; }
        canvas { display: block; width: 100%; flex: 1; }
        
        .graph-container {
            height: 150px; background: #0f172a; border-top: 1px solid #334155; position: relative;
        }
        .graph-label { position: absolute; top: 5px; left: 10px; color: #64748b; font-size: 0.7rem; font-weight: bold; }

        .overlay-instruction {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.9); padding: 10px 20px; border-radius: 30px;
            font-weight: 600; color: var(--text-main); pointer-events: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<aside>
    <div class="logo">Raporlab <span style="font-weight:300; color:#64748b;">襤nteraktif</span></div>

    <div class="meter-box">
        <div class="meter-scale">
            <div style="position:absolute; left:0; bottom:-20px; font-size:0.7rem;">-V</div>
            <div style="position:absolute; left:50%; bottom:-20px; font-size:0.7rem; transform:translateX(-50%);">0</div>
            <div style="position:absolute; right:0; bottom:-20px; font-size:0.7rem;">+V</div>
        </div>
        <div class="needle" id="needle"></div>
        <div class="meter-val"><span id="valVolt">0.00</span> V</div>
    </div>

    <div class="control-group" style="text-align:center;">
        <div class="group-title">Lamba Parlakl覺覺</div>
        <div class="bulb-indicator" id="bulb"></div>
        <div style="font-size:0.8rem; color:#64748b; margin-top:5px;">Hareket Yok = I覺k Yok</div>
    </div>

    <div class="control-group">
        <div class="group-title">Bobin Ayarlar覺</div>
        <div class="slider-row">
            <span>Sar覺m (N): <span id="valLoops">4</span></span>
        </div>
        <input type="range" id="slLoops" min="2" max="10" step="1" value="4">
        
        <div class="slider-row" style="margin-top:10px;">
            <span>Alan (A): <span id="valArea">100</span>%</span>
        </div>
        <input type="range" id="slArea" min="50" max="150" step="10" value="100">
    </div>

    <div class="control-group">
        <div class="group-title">M覺knat覺s Ayarlar覺</div>
        <div class="slider-row">
            <span>G羹癟 (B): <span id="valStr">100</span>%</span>
        </div>
        <input type="range" id="slStr" min="10" max="200" step="10" value="100">
        
        <div style="margin-top:10px; display:flex; gap:10px;">
            <button onclick="app.flipMagnet()" style="flex:1; padding:8px; cursor:pointer; background:white; border:1px solid #cbd5e1; border-radius:6px; font-weight:600;">Kutuplar覺 evir</button>
        </div>
    </div>

    <div class="formula-box">
        庰 = -N 繚 (峖 / t)<br>
        Voltaj 羹retmek i癟in <b>DE襤襤M</b> artt覺r. M覺knat覺s durursa voltaj s覺f覺r olur.
    </div>
</aside>

<main>
    <div style="position:relative; flex:1;">
        <div class="overlay-instruction">妓 M覺knat覺s覺 Bobinin 襤癟inde HIZLA Hareket Ettir!</div>
        <canvas id="simCanvas"></canvas>
    </div>
    <div class="graph-container">
        <span class="graph-label">VOLTAJ ZAMAN GRAF襤襤 (OS襤LOSKOP)</span>
        <canvas id="graphCanvas"></canvas>
    </div>
</main>

<script>
const app = {
    canvas: document.getElementById('simCanvas'),
    ctx: null,
    gCanvas: document.getElementById('graphCanvas'),
    gCtx: null,
    
    width: 0, height: 0,
    gw: 0, gh: 0,

    // Fizik Durumu
    magnet: { x: 100, y: 0, vx: 0, w: 140, h: 50, flipped: false },
    coil: { x: 0, y: 0, radius: 60, loops: 4 },
    
    physics: {
        flux: 0,
        prevFlux: 0,
        voltage: 0,
        strength: 1.0, 
        history: [] 
    },

    isDragging: false,
    dragOffset: {x:0, y:0},

    init() {
        this.ctx = this.canvas.getContext('2d');
        this.gCtx = this.gCanvas.getContext('2d');
        
        this.resize();
        window.addEventListener('resize', () => this.resize());
        
        this.resetPositions();
        this.setupEvents();
        this.setupUI();
        
        this.loop();
    },

    resize() {
        const p = this.canvas.parentElement;
        this.width = this.canvas.width = p.clientWidth;
        this.height = this.canvas.height = p.clientHeight;
        
        this.gw = this.gCanvas.width = this.gCanvas.parentElement.clientWidth;
        this.gh = this.gCanvas.height = this.gCanvas.parentElement.clientHeight;

        // Bobin Merkezde
        this.coil.x = this.width / 2;
        this.coil.y = this.height / 2;
        this.magnet.y = this.height / 2;
        
        // Yeniden boyutlan覺nca m覺knat覺s覺 kaybetmemek i癟in g羹ncelle
        // Eer s羹r羹klenmiyorsa bobinin soluna park et
        if (!this.isDragging) {
             this.resetPositions();
        }
    },

    resetPositions() {
        // MIKNATIS KONUMU DZELT襤LD襤:
        // Bobinin merkezinden 180 piksel sola (癟ok daha yak覺n ve eriilebilir)
        this.magnet.x = this.coil.x - 180;
    },

    setupUI() {
        document.getElementById('slLoops').oninput = (e) => {
            this.coil.loops = parseInt(e.target.value);
            document.getElementById('valLoops').innerText = this.coil.loops;
        };
        document.getElementById('slArea').oninput = (e) => {
            this.coil.radius = 60 * (parseInt(e.target.value)/100);
            document.getElementById('valArea').innerText = e.target.value;
        };
        document.getElementById('slStr').oninput = (e) => {
            this.physics.strength = parseInt(e.target.value)/100;
            document.getElementById('valStr').innerText = e.target.value;
        };
    },

    flipMagnet() {
        this.magnet.flipped = !this.magnet.flipped;
    },

    // --- F襤Z襤K MOTORU ---
    updatePhysics() {
        const dist = (this.magnet.x - this.coil.x);
        const polarity = this.magnet.flipped ? -1 : 1;
        const sigma = 150; 
        const rawFlux = Math.exp(-(dist*dist)/(2*sigma*sigma));
        const areaFactor = (this.coil.radius / 60) * (this.coil.radius / 60);
        
        this.physics.flux = rawFlux * this.physics.strength * areaFactor * polarity;
        const dFlux = this.physics.flux - this.physics.prevFlux;
        this.physics.voltage = -this.coil.loops * dFlux * 50; 
        this.physics.prevFlux = this.physics.flux;

        this.physics.history.push(this.physics.voltage);
        if(this.physics.history.length > 300) this.physics.history.shift();

        this.updateUIComponents();
    },

    updateUIComponents() {
        const v = this.physics.voltage;
        let angle = v * 5; 
        if(angle > 60) angle = 60; if(angle < -60) angle = -60;
        document.getElementById('needle').style.transform = `translateX(-50%) rotate(${angle}deg)`;
        document.getElementById('valVolt').innerText = v.toFixed(2);
        
        const brightness = Math.min(Math.abs(v) * 20, 100); 
        const bulb = document.getElementById('bulb');
        
        if(brightness > 5) {
            bulb.style.background = `rgb(255, 255, ${255 - brightness*2})`; 
            bulb.style.boxShadow = `0 0 ${brightness}px ${brightness/2}px rgba(255, 223, 0, ${brightness/100})`;
            bulb.style.borderColor = "#fbbf24";
        } else {
            bulb.style.background = "#475569";
            bulb.style.boxShadow = "none";
            bulb.style.borderColor = "#334155";
        }
    },

    // --- 襤Z襤M ---
    draw() {
        const ctx = this.ctx;
        ctx.clearRect(0, 0, this.width, this.height);

        this.drawGrid(ctx);
        this.drawCoil(ctx, true);
        this.drawMagnet(ctx);
        this.drawFieldLines(ctx);
        this.drawCoil(ctx, false);
        this.drawGraph();
    },

    drawGrid(ctx) {
        ctx.strokeStyle = "#cbd5e1"; ctx.lineWidth = 1; ctx.beginPath();
        for(let x=0; x<this.width; x+=50) { ctx.moveTo(x,0); ctx.lineTo(x,this.height); }
        for(let y=0; y<this.height; y+=50) { ctx.moveTo(0,y); ctx.lineTo(this.width,y); }
        ctx.stroke();
    },

    drawMagnet(ctx) {
        const m = this.magnet;
        ctx.save();
        ctx.translate(m.x, m.y);
        
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.fillRect(-m.w/2 + 10, -m.h/2 + 10, m.w, m.h);

        const leftCol = m.flipped ? "#3b82f6" : "#ef4444"; 
        const rightCol = m.flipped ? "#ef4444" : "#3b82f6"; 
        const leftTxt = m.flipped ? "S" : "N";
        const rightTxt = m.flipped ? "N" : "S";

        ctx.fillStyle = leftCol; ctx.fillRect(-m.w/2, -m.h/2, m.w/2, m.h);
        ctx.fillStyle = rightCol; ctx.fillRect(0, -m.h/2, m.w/2, m.h);
        
        ctx.fillStyle = "white"; ctx.font = "bold 24px sans-serif"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
        ctx.fillText(leftTxt, -m.w/4, 0);
        ctx.fillText(rightTxt, m.w/4, 0);
        ctx.restore();
    },

    drawCoil(ctx, backLayer) {
        const c = this.coil;
        const w = 150; 
        const loops = c.loops;
        const step = w / loops;
        ctx.lineWidth = 6; ctx.lineCap = "round";
        const startX = c.x - w/2;

        for(let i=0; i<loops; i++) {
            const loopX = startX + i*step;
            if(backLayer) {
                ctx.beginPath(); ctx.strokeStyle = "#92400e"; 
                ctx.ellipse(loopX + step/2, c.y, step/3, c.radius, 0, Math.PI, 0); 
                ctx.stroke();
            } else {
                ctx.beginPath();
                const glow = Math.min(Math.abs(this.physics.voltage)*5, 100);
                ctx.strokeStyle = `rgb(${180+glow}, ${83+glow}, ${9+glow})`; 
                ctx.shadowBlur = glow/2; ctx.shadowColor = "yellow";
                ctx.ellipse(loopX + step/2, c.y, step/3, c.radius, 0, 0, Math.PI); 
                ctx.stroke();
                ctx.shadowBlur = 0;
            }
        }
    },

    drawFieldLines(ctx) {
        const m = this.magnet;
        ctx.save();
        ctx.translate(m.x, m.y);
        ctx.globalAlpha = 0.3;
        ctx.strokeStyle = m.flipped ? "#3b82f6" : "#ef4444";
        ctx.lineWidth = 2;
        for(let r=40; r<=100; r+=20) {
            ctx.beginPath();
            ctx.ellipse(0, 0, m.w/2 + r*2, m.h/2 + r, 0, 0, Math.PI*2);
            ctx.stroke();
        }
        ctx.restore();
    },

    drawGraph() {
        const ctx = this.gCtx;
        const w = this.gw; const h = this.gh;
        ctx.clearRect(0,0,w,h);

        ctx.strokeStyle = "#334155"; ctx.lineWidth=1;
        ctx.beginPath(); ctx.moveTo(0, h/2); ctx.lineTo(w, h/2); ctx.stroke();

        ctx.beginPath();
        ctx.strokeStyle = "#facc15"; ctx.lineWidth = 2;
        const data = this.physics.history;
        const step = w / 300;
        for(let i=0; i<data.length; i++) {
            const x = i * step;
            const y = h/2 - (data[i] * 5); 
            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        }
        ctx.stroke();
    },

    // --- EVENTS ---
    setupEvents() {
        const start = (e) => {
            const rect = this.canvas.getBoundingClientRect();
            const cx = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const cy = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            const mx = cx - rect.left;
            const my = cy - rect.top;

            if(mx > this.magnet.x - this.magnet.w/2 - 20 && mx < this.magnet.x + this.magnet.w/2 + 20 &&
               my > this.magnet.y - this.magnet.h/2 - 20 && my < this.magnet.y + this.magnet.h/2 + 20) {
                this.isDragging = true;
                this.dragOffset.x = mx - this.magnet.x;
            }
        };

        const move = (e) => {
            if(this.isDragging) {
                const rect = this.canvas.getBoundingClientRect();
                const cx = e.clientX || (e.touches ? e.touches[0].clientX : 0);
                const mx = cx - rect.left;
                this.magnet.x = mx - this.dragOffset.x;
            }
        };

        const end = () => { this.isDragging = false; };

        this.canvas.addEventListener('mousedown', start);
        window.addEventListener('mousemove', move);
        window.addEventListener('mouseup', end);
        this.canvas.addEventListener('touchstart', (e) => { e.preventDefault(); start(e); }, {passive:false});
        window.addEventListener('touchmove', (e) => { e.preventDefault(); move(e); }, {passive:false});
        window.addEventListener('touchend', end);
    },

    loop() {
        this.updatePhysics();
        this.draw();
        requestAnimationFrame(() => this.loop());
    }
};

app.init();
</script>
</body>
</html>
