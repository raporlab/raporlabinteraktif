<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raporlab Pro - Kaldƒ±rma Kuvveti v2</title>
    <style>
        :root {
            /* RAPORLAB PRO TEMA (v10.1 - Buoyancy Fixed) */
            --bg-app: #f0f9ff;      
            --bg-panel: #ffffff;    
            --text-main: #0c4a6e;
            --text-muted: #64748b;
            
            --color-primary: #0ea5e9; 
            --color-force-b: #3b82f6; /* Kaldƒ±rma Kuvveti (Mavi) */
            --color-force-g: #ef4444; /* Yer√ßekimi (Kƒ±rmƒ±zƒ±) */
            
            --border: #e0f2fe;
            --radius: 20px;
            --font: 'Segoe UI', 'Inter', sans-serif;
            --font-mono: 'Consolas', monospace;
        }

        body { 
            margin: 0; padding: 0; 
            background: var(--bg-app); 
            color: var(--text-main); 
            font-family: var(--font); 
            height: 100vh; 
            display: flex; 
            overflow: hidden; 
        }

        /* --- SOL PANEL --- */
        aside { 
            width: 380px; flex-shrink: 0;
            background: var(--bg-panel); 
            border-right: 1px solid var(--border); 
            padding: 25px; 
            display: flex; flex-direction: column; gap: 20px; 
            z-index: 20; box-shadow: 5px 0 30px rgba(0,0,0,0.03);
            overflow-y: auto;
        }

        .logo { font-size: 1.6rem; font-weight: 800; color: var(--color-primary); letter-spacing: -1px; margin-bottom: 10px; }
        
        /* Veri Kartlarƒ± */
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .data-card {
            background: #f0f9ff; padding: 15px; border-radius: 12px; border: 1px solid #bae6fd;
            text-align: center;
        }
        .data-val { font-family: var(--font-mono); font-size: 1.2rem; font-weight: bold; color: var(--text-main); }
        .data-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; margin-top: 5px; }

        /* Kontroller */
        .control-group { background: white; border: 2px solid var(--border); padding: 15px; border-radius: 16px; }
        .group-title { font-size: 0.85rem; font-weight: 700; margin-bottom: 10px; display: flex; justify-content: space-between; }
        
        .slider-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        input[type="range"] { flex: 1; accent-color: var(--color-primary); cursor: pointer; }
        
        /* Materyal Butonlarƒ± */
        .mat-btn-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-bottom: 15px; }
        .mat-btn {
            padding: 8px; font-size: 0.8rem; border: 1px solid var(--border); background: white;
            border-radius: 8px; cursor: pointer; color: var(--text-muted); font-weight: 600; transition: 0.2s;
        }
        .mat-btn:hover { background: #e0f2fe; color: var(--color-primary); }
        .mat-btn.active { background: var(--color-primary); color: white; border-color: var(--color-primary); box-shadow: 0 2px 5px rgba(14, 165, 233, 0.3); }

        .info-panel { 
            margin-top: auto; background: #fff1f2; 
            border-left: 4px solid var(--color-force-g); 
            padding: 15px; border-radius: 12px; 
            font-size: 0.85rem; line-height: 1.5; color: #881337;
        }

        /* --- MAIN --- */
        main { 
            flex: 1; position: relative; 
            /* Arka planƒ± canvas'ta √ßizeceƒüiz */
            display: flex; justify-content: center; align-items: center;
            cursor: grab;
            z-index: 1; /* Canvas'ƒ± geriye al */
        }
        main:active { cursor: grabbing; }

        #simCanvas {
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            /* Canvas arka planƒ± ≈üeffaf */
            background: transparent;
        }

        .overlay-tip {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.9); padding: 8px 16px; border-radius: 20px;
            font-size: 0.9rem; color: var(--color-primary); font-weight: 600; pointer-events: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 10; /* Canvas'ƒ±n √ºst√ºnde kal */
            border: 1px solid var(--border);
        }
    </style>
</head>
<body>

<aside>
    <div class="logo">Raporlab <span style="font-weight:300; color:#64748b;">Ar≈üimet</span></div>

    <div class="data-grid">
        <div class="data-card">
            <div class="data-val" id="valFk" style="color:var(--color-force-b)">0 N</div>
            <div class="data-label">Kaldƒ±rma (Fk)</div>
        </div>
        <div class="data-card">
            <div class="data-val" id="valG" style="color:var(--color-force-g)">0 N</div>
            <div class="data-label">Aƒüƒ±rlƒ±k (G)</div>
        </div>
        <div class="data-card">
            <div class="data-val" id="valVbatan">0 %</div>
            <div class="data-label">Batan Hacim</div>
        </div>
        <div class="data-card" style="background:#fffbeb; border-color:#fcd34d;">
            <div class="data-val" id="valNet" style="color:#b45309">0 N</div>
            <div class="data-label">Net Kuvvet</div>
        </div>
    </div>

    <div class="control-group" id="objControls">
        <div class="group-title">Cisim √ñzellikleri <span id="lblObjDensity">0.6 g/cm¬≥</span></div>
        <div class="mat-btn-grid">
            <button class="mat-btn" data-val="0.15" onclick="app.setMaterial(0.15)">K√∂p√ºk</button>
            <button class="mat-btn active" data-val="0.6" onclick="app.setMaterial(0.6)">Tahta</button>
            <button class="mat-btn" data-val="2.2" onclick="app.setMaterial(2.2)">Tuƒüla</button>
        </div>
        <div class="slider-row">
            <span style="font-size:0.8rem; width:50px;">√ñzk√ºtle</span>
            <input type="range" id="slObjD" min="0.1" max="3.0" step="0.05" value="0.6">
        </div>
        <div class="slider-row">
            <span style="font-size:0.8rem; width:50px;">Hacim</span>
            <input type="range" id="slObjV" min="50" max="150" step="10" value="100">
        </div>
    </div>

    <div class="control-group" id="liqControls">
        <div class="group-title">Sƒ±vƒ± √ñzellikleri <span id="lblLiqDensity">1.0 g/cm¬≥</span></div>
        <div class="mat-btn-grid">
            <button class="mat-btn" data-val="0.8" onclick="app.setLiquid(0.8)">Yaƒü</button>
            <button class="mat-btn active" data-val="1.0" onclick="app.setLiquid(1.0)">Su</button>
            <button class="mat-btn" data-val="1.4" onclick="app.setLiquid(1.4)">Bal</button>
        </div>
        <div class="slider-row">
            <span style="font-size:0.8rem; width:50px;">√ñzk√ºtle</span>
            <input type="range" id="slLiqD" min="0.5" max="2.0" step="0.1" value="1.0">
        </div>
    </div>

    <div class="info-panel">
        <b>Ar≈üimet Prensibi:</b> Cisim, batan hacmi kadar sƒ±vƒ±nƒ±n aƒüƒ±rlƒ±ƒüƒ±na e≈üit bir kuvvetle yukarƒ± itilir. <br>
        <i>Fk = Vbatan √ó dsƒ±vƒ± √ó g</i>
    </div>
</aside>

<main>
    <div class="overlay-tip">üñ±Ô∏è Cismi tutmak ve batƒ±rmak i√ßin s√ºr√ºkleyin!</div>
    <canvas id="simCanvas"></canvas>
</main>

<script>
    const app = {
        canvas: document.getElementById('simCanvas'),
        ctx: null,
        width: 0, height: 0,
        g: 9.8,
        
        state: {
            // Sƒ±vƒ±
            liqDensity: 1.0,
            waterLevelY: 0,
            baseWaterLevel: 0.6, // %60 su
            visualRise: 0,

            // Cisim
            objDensity: 0.6,
            objMass: 0, 
            objSize: 100, 
            
            // Konum & Hareket
            x: 0, y: 0, vy: 0, isDragging: false,
            
            // Hesaplananlar
            vSubmerged: 0, buoyancyForce: 0, weightForce: 0
        },

        // Renk Paletleri
        liqColors: {
            water: { top: "rgba(14, 165, 233, 0.6)", bottom: "rgba(59, 130, 246, 0.8)" }, // Mavi
            oil: { top: "rgba(234, 179, 8, 0.7)", bottom: "rgba(202, 138, 4, 0.8)" },     // Sarƒ±
            honey: { top: "rgba(245, 158, 11, 0.8)", bottom: "rgba(180, 83, 9, 0.9)" }    // Turuncu
        },
        currentLiqColor: null, // init'te atanacak

        init: function() {
            this.ctx = this.canvas.getContext('2d');
            this.resize();
            this.currentLiqColor = this.liqColors.water; // Varsayƒ±lan Su

            // Ba≈ülangƒ±√ß Konumu
            this.state.x = this.width / 2;
            this.state.y = this.height * 0.2; 
            
            // Listeners
            this.setupMouseEvents();
            this.setupControls();

            // ƒ∞lk hesaplama
            this.updateObjProps(0.6, 100); 
            this.loop();
        },

        setupControls: function() {
            // Cisim Slider
            const slObjD = document.getElementById('slObjD');
            slObjD.addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                this.updateObjProps(val, null);
                this.syncButtons('objControls', val); // Slider -> Buton senk.
            });
            document.getElementById('slObjV').addEventListener('input', (e) => this.updateObjProps(null, parseInt(e.target.value)));
            
            // Sƒ±vƒ± Slider
            const slLiqD = document.getElementById('slLiqD');
            slLiqD.addEventListener('input', (e) => {
                const val = parseFloat(e.target.value);
                this.updateLiqProps(val);
                this.syncButtons('liqControls', val); // Slider -> Buton senk.
            });
        },

        resize: function() {
            const m = document.querySelector('main');
            this.width = this.canvas.width = m.clientWidth - 40;
            this.height = this.canvas.height = m.clientHeight - 40;
            this.state.waterLevelY = this.height * (1 - this.state.baseWaterLevel);
        },

        // --- KONTROL FONKSƒ∞YONLARI ---
        setMaterial: function(val) {
            document.getElementById('slObjD').value = val;
            this.updateObjProps(val, null);
            this.syncButtons('objControls', val);
        },

        setLiquid: function(val) {
            document.getElementById('slLiqD').value = val;
            this.updateLiqProps(val);
            this.syncButtons('liqControls', val);
        },

        // Slider deƒüeri deƒüi≈üince ilgili butonu aktif yap
        syncButtons: function(groupId, val) {
            const btns = document.querySelectorAll(`#${groupId} .mat-btn`);
            btns.forEach(b => b.classList.remove('active'));
            
            // Deƒüeri e≈üle≈üen butonu bul (Hassasiyet sorunu i√ßin k√º√ß√ºk bir toleransla)
            const match = Array.from(btns).find(b => Math.abs(parseFloat(b.dataset.val) - val) < 0.01);
            if(match) match.classList.add('active');
        },

        updateObjProps: function(d, s) {
            if(d !== null) this.state.objDensity = d;
            if(s !== null) this.state.objSize = s;
            this.state.objMass = this.state.objSize * this.state.objDensity;
            document.getElementById('lblObjDensity').innerText = this.state.objDensity.toFixed(2) + " g/cm¬≥";
        },

        updateLiqProps: function(d) {
            this.state.liqDensity = d;
            document.getElementById('lblLiqDensity').innerText = d.toFixed(1) + " g/cm¬≥";
            
            // Rengi Deƒüi≈ütir
            if(d < 0.9) this.currentLiqColor = this.liqColors.oil;
            else if(d > 1.2) this.currentLiqColor = this.liqColors.honey;
            else this.currentLiqColor = this.liqColors.water;
        },

        // --- Fƒ∞Zƒ∞K MOTORU ---
        updatePhysics: function() {
            const s = this.state;
            const halfSize = s.objSize / 2;
            const bottomY = s.y + halfSize;

            // 1. Batan Hacim Hesabƒ±
            let submergedH = 0;
            if (bottomY > s.waterLevelY) {
                submergedH = Math.min(s.objSize, bottomY - s.waterLevelY);
            }
            s.vSubmerged = Math.max(0, submergedH / s.objSize);

            // 2. Kuvvetler (√ñl√ßekli)
            s.weightForce = s.objMass * this.g * 0.1;
            s.buoyancyForce = (s.objSize * s.vSubmerged) * s.liqDensity * this.g * 0.1;

            // 3. Hareket
            if (!s.isDragging) {
                const netForce = s.buoyancyForce - s.weightForce;
                
                // S√ºrt√ºnme (Viskoziteye g√∂re deƒüi≈üir)
                let dragCoeff = s.vSubmerged > 0 ? 0.15 : 0.02;
                if(s.vSubmerged > 0) dragCoeff *= (s.liqDensity * s.liqDensity); // Balda daha √ßok s√ºrt√ºnme
                const dragForce = -s.vy * dragCoeff * s.objMass;
                
                const accel = (netForce + dragForce) / s.objMass;
                s.vy += accel;
                s.y -= s.vy;

                // Zemin √áarpƒ±≈ümasƒ±
                if (s.y + halfSize > this.height) {
                    s.y = this.height - halfSize;
                    s.vy *= -0.2;
                }
            } else {
                s.vy = 0;
            }

            // 4. Su Y√ºkselmesi Efekti
            s.visualRise = (s.vSubmerged * s.objSize * s.objSize) / this.width;

            // UI G√ºncelleme
            this.updateUI(s);
        },

        updateUI: function(s) {
            document.getElementById('valFk').innerText = Math.round(s.buoyancyForce) + " N";
            document.getElementById('valG').innerText = Math.round(s.weightForce) + " N";
            document.getElementById('valVbatan').innerText = "%" + Math.round(s.vSubmerged * 100);
            document.getElementById('valNet').innerText = Math.round(s.buoyancyForce - s.weightForce) + " N";
        },

        // --- √áƒ∞Zƒ∞M ---
        draw: function() {
            const ctx = this.ctx;
            const s = this.state;
            const w = this.width; const h = this.height;

            ctx.clearRect(0, 0, w, h);

            // 1. Arka Plan (Hava)
            const visualWaterY = s.waterLevelY - s.visualRise;
            const skyGrad = ctx.createLinearGradient(0, 0, 0, visualWaterY);
            skyGrad.addColorStop(0, "#f0f9ff"); skyGrad.addColorStop(1, "#e0f2fe");
            ctx.fillStyle = skyGrad; ctx.fillRect(0, 0, w, visualWaterY);

            // 2. Sƒ±vƒ±
            const liqGrad = ctx.createLinearGradient(0, visualWaterY, 0, h);
            liqGrad.addColorStop(0, this.currentLiqColor.top);
            liqGrad.addColorStop(1, this.currentLiqColor.bottom);
            
            ctx.fillStyle = liqGrad;
            ctx.fillRect(0, visualWaterY, w, h - visualWaterY);
            
            // Y√ºzey √áizgisi
            ctx.strokeStyle = "rgba(255,255,255,0.4)"; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(0, visualWaterY); ctx.lineTo(w, visualWaterY); ctx.stroke();

            // 3. Cisim
            this.drawObject(ctx, s);

            // 4. Vekt√∂rler
            ctx.save(); ctx.translate(s.x, s.y);
            this.drawArrow(ctx, 0, 0, 0, s.weightForce, "var(--color-force-g)", "G");
            this.drawArrow(ctx, 0, 0, 0, -s.buoyancyForce, "var(--color-force-b)", "Fk");
            ctx.restore();
        },

        drawObject: function(ctx, s) {
            const half = s.objSize / 2;
            ctx.save();
            ctx.translate(s.x, s.y);
            
            // Renk (√ñzk√ºtleye g√∂re)
            const lightness = Math.max(20, 85 - (s.objDensity * 25)); 
            ctx.fillStyle = `hsl(35, ${s.objDensity < 0.3 ? 0 : 60}%, ${lightness}%)`;
            if (s.objDensity > 2.0) ctx.fillStyle = `hsl(0, 60%, ${lightness}%)`; // Tuƒüla rengi

            ctx.beginPath();
            ctx.roundRect(-half, -half, s.objSize, s.objSize, 8);
            ctx.fill();
            ctx.strokeStyle = "rgba(0,0,0,0.3)"; ctx.lineWidth = 2; ctx.stroke();
            
            // Merkez
            ctx.fillStyle = "rgba(0,0,0,0.5)"; ctx.beginPath(); ctx.arc(0,0,3,0,Math.PI*2); ctx.fill();
            ctx.restore();
        },

        drawArrow: function(ctx, x, y, dx, dy, color, label) {
            const scale = 0.8; const vecLen = dy * scale;
            if (Math.abs(vecLen) < 5) return;

            ctx.beginPath(); ctx.strokeStyle = color; ctx.fillStyle = color; ctx.lineWidth = 4;
            ctx.moveTo(x, y); ctx.lineTo(x + dx, y + vecLen); ctx.stroke();

            const headLen = 10; const angle = Math.atan2(vecLen, dx);
            ctx.beginPath();
            ctx.moveTo(x + dx, y + vecLen);
            ctx.lineTo(x + dx - headLen * Math.cos(angle - Math.PI/6), y + vecLen - headLen * Math.sin(angle - Math.PI/6));
            ctx.lineTo(x + dx - headLen * Math.cos(angle + Math.PI/6), y + vecLen - headLen * Math.sin(angle + Math.PI/6));
            ctx.fill();

            ctx.font = "bold 14px sans-serif"; ctx.fillText(label, x + 15, y + vecLen/2 + 5);
        },

        // --- MOUSE EVENTLERƒ∞ ---
        setupMouseEvents: function() {
            const startDrag = (e) => {
                const rect = this.canvas.getBoundingClientRect();
                const cx = (e.clientX || e.pageX) - rect.left;
                const cy = (e.clientY || e.pageY) - rect.top;
                const half = this.state.objSize / 2;
                if (cx > this.state.x - half && cx < this.state.x + half &&
                    cy > this.state.y - half && cy < this.state.y + half) {
                    this.state.isDragging = true;
                }
            };
            const moveDrag = (e) => {
                if (!this.state.isDragging) return;
                const rect = this.canvas.getBoundingClientRect();
                const cy = (e.clientY || e.pageY) - rect.top;
                this.state.y = Math.max(this.state.objSize/2, Math.min(this.height - this.state.objSize/2, cy));
                this.state.vy = 0;
            };
            const endDrag = () => { this.state.isDragging = false; };

            this.canvas.addEventListener('mousedown', startDrag);
            window.addEventListener('mousemove', moveDrag);
            window.addEventListener('mouseup', endDrag);
            this.canvas.addEventListener('touchstart', (e) => startDrag(e.touches[0]));
            window.addEventListener('touchmove', (e) => moveDrag(e.touches[0]));
            window.addEventListener('touchend', endDrag);
        },

        loop: function() {
            this.updatePhysics();
            this.draw();
            requestAnimationFrame(() => this.loop());
        }
    };

    app.init();
</script>
</body>
</html>
